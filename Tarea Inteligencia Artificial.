import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from scipy import stats


sns.set(style="whitegrid")
plt.rcParams['figure.figsize'] = (12, 8)


try:
    df = pd.read_csv('train.csv')
    print("Archivo cargado exitosamente")
except FileNotFoundError:
    print("Error: No se encontró el archivo train.csv")
    print("Por favor, asegúrate de que el archivo esté en el directorio correcto")

print("Dimensiones del dataset:", df.shape)
print("\nPrimeras 5 filas:")
print(df.head())

print("\nInformación del dataset:")
print(df.info())

null_report = df.isnull().sum()
null_report = null_report[null_report > 0].sort_values(ascending=False)
print("\nValores nulos por columna:")
print(null_report)

df_clean = df.copy()

cols_to_drop = ['PoolQC', 'MiscFeature', 'Alley', 'Fence']
df_clean = df_clean.drop(columns=cols_to_drop)

df_clean['FireplaceQu'] = df_clean['FireplaceQu'].fillna('No Fireplace')

lot_frontage_median = df_clean.groupby('Neighborhood')['LotFrontage'].transform('median')
df_clean['LotFrontage'] = df_clean['LotFrontage'].fillna(lot_frontage_median)

garage_cols = ['GarageType', 'GarageFinish', 'GarageQual', 'GarageCond']
for col in garage_cols:
    df_clean[col] = df_clean[col].fillna('No Garage')

df_clean['GarageYrBlt'] = df_clean['GarageYrBlt'].fillna(df_clean['YearBuilt'])

bsmt_cols = ['BsmtQual', 'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2']
for col in bsmt_cols:
    df_clean[col] = df_clean[col].fillna('No Basement')

df_clean['MasVnrType'] = df_clean['MasVnrType'].fillna(df_clean['MasVnrType'].mode()[0])
df_clean['MasVnrArea'] = df_clean['MasVnrArea'].fillna(df_clean['MasVnrArea'].median())

df_clean['Electrical'] = df_clean['Electrical'].fillna(df_clean['Electrical'].mode()[0])

print("\nValores nulos restantes después de la limpieza:", df_clean.isnull().sum().sum())

print("\nResumen estadístico:")
print(df_clean.describe())

plt.figure(figsize=(12, 6))
sns.histplot(df_clean['SalePrice'], kde=True, bins=50)
plt.title('Distribución de Precios de Venta (SalePrice)')
plt.xlabel('Precio de Venta ($)')
plt.ylabel('Frecuencia')
plt.show()

correlation_matrix = df_clean.select_dtypes(include=[np.number]).corr()
saleprice_corr = correlation_matrix['SalePrice'].sort_values(ascending=False)
print("\nVariables más correlacionadas con SalePrice:")
print(saleprice_corr.head(10))

plt.figure(figsize=(16, 12))
top_corr_features = correlation_matrix.index[abs(correlation_matrix['SalePrice']) > 0.5]
top_corr_matrix = correlation_matrix.loc[top_corr_features, top_corr_features]
sns.heatmap(top_corr_matrix, annot=True, cmap='coolwarm', center=0)
plt.title('Matriz de Correlación de Variables con SalePrice (r > 0.5)')
plt.show()

print("""
CONCLUSIONES FINALES
FACTORES QUE MÁS INFLUYEN EN EL PRECIO DE LAS VIVIENDAS:
1. CALIDAD GENERAL (OverallQual) - Correlación: 0.79

La variable más determinante con la correlación más fuerte (0.79)

Escala del 1-10 donde cada punto adicional aumenta significativamente el valor

Propiedades con calificación 9-10 alcanzan precios excepcionales

2. ÁREA HABITABLE (GrLivArea) - Correlación: 0.71

Segundo factor más importante - tamaño directamente proporcional al precio

Cada pie cuadrado adicional aumenta el valor de la propiedad

Propiedades sobre 4000 sq.ft. alcanzan los precios más premium

3. CAPACIDAD DEL GARAJE (GarageCars) - Correlación: 0.64

Tercer factor en importancia - número de coches que caben en el garaje

Garajes para 3+ vehículos añaden valor significativo

Más importante que el área total del garaje (0.62)

ESTRATEGIA DE MARKETING:

Destacar la calidad general (OverallQual) como principal argumento de venta

Enfocar en vecindarios premium con mayor apreciación de valor

Promover número de baños completos y espacios habitables

Visualizar ampliaciones potenciales para aumentar valor
""")
